JVM的组成



　　JVM定义了控制Java代码[解释执行](http://baike.so.com/doc/358371.html)和具体实现的五种规格，因此把JVM分成了6个部分：JVM解释器、指令系统、寄存器、栈、存储区和碎片回收区。

　　◆JVM解释器：即这个虚拟机处理字段码的CPU。



　　◆JVM指令系统：该系统与计算机很相似，一条指令由操作码和操作数两部分组成。操作码为8位二进制数，主要是为了说明一条指令的功能，操作数可以根据需要而定，JVM最多有256种不同的操作指令。目前已使用了160多种操作码。



　　◆寄存器：JVM有自己的虚拟寄存器，这样就可以快速地与JVM的解释器进行数据交换。为了功能的需要，JVM设置了4个常用的32位寄存器：pc（程序计数器）、optop（操作数栈顶指针）、frame（当前执行环境指针）和vars（指向当前执行环境中第一个局部变量的指针）。



　　◆JVM栈：指令执行时数据和信息存储的场所和控制中心，它提供给JVM解释器运算所需要的信息。当JVM得到一个Java字节码[应用程序](http://baike.so.com/doc/3417785.html)后，便为该代码中一个类的每一个方法创建一个栈框架，以保存该方法的状态信息。每个栈框架包括以下三类信息：局部变量、执行环境、操作数栈。

　　局部变量用于存储一个类的方法中所用到的局部变量。vars寄存器指向该[变量](http://baike.so.com/doc/2977483.html)表中的第一个局部变量。

　　执行环境用于保存解释器对Java字节码进行解释过程中所需的信息。它们是：上次调用的方法、局部变量[指针](http://baike.so.com/doc/1043844.html)和操作数栈的栈顶和栈底指针。执行环境是一个执行一个方法的[控制中心](http://baike.so.com/doc/6291333.html)。例如：如果解释器要执行iadd（整数加法），首先要从frame寄存器中找到当前执行环境，而后便从执行环境中找到操作数栈，从栈顶弹出两个整数进行加法运算，最后将结果压入栈顶。

　　操作数栈用于存储运算所需操作数及运算的结果。



　　◆存储区：JVM有两类存储区：常量缓冲池和方法区。常量缓冲池用于存储类名称、方法和字段名称以及串常量。方法区则用于存储Java方法的字节码。



　　◆碎片回收区：JVM碎片回收是指将使用过的Java类的具体实例从内存进行回收，这就使得开发人员免去了自己编程控制内存的麻烦和危险。随着JVM的不断升级，其碎片回收的技术和算法也更加合理。JVM 1.4.1版后产生了一种叫分代收集技术，简单来说就是利用对象在程序中生存的时间划分成代，以此为标准进行碎片回收。

